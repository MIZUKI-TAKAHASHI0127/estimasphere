<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <h2>Purchase Quotations</h2>


      <!-- Search form -->
      <div class="my-3">
        <%= form_with url: purchase_quotations_path, method: :get, local: true do |f| %>
          <div class="row">
            <div class="col-md-2">
              <%= f.label :customer_name, "顧客名" %>
              <%= f.text_field :customer_name, class: "form-control" %>
            </div>

            <div class="col-md-2">
              <%= f.label :quotation_number, "見積番号" %>
              <%= f.text_field :quotation_number, class: "form-control" %>
            </div>

            <div class="col-md-2">
              <%= f.label :category_name, "カテゴリー" %>
              <%= f.text_field :category_name, class: "form-control" %>
            </div>

            <div class="col-md-2">
              <%= f.label :item_name, "品名" %>
              <%= f.text_field :item_name, class: "form-control" %>
            </div>

            <div class="col-md-2 align-self-end">
              <%= f.submit "検索", class: "btn btn-primary" %>
              <%= link_to "リセット", purchase_quotations_path, class: "btn btn-secondary ml-2" %>
            </div>
          </div>
        <% end %>
      </div>

      <table class="table table-bordered table-custom-height">
        <thead>
          <tr>
            <th class="col-date">作成日</th>
            <th class="col-customer">顧客名</th>
            <th class="col-number">見積番号</th>
            <th class="col-category">カテゴリー</th>
            <th class="col-item-name">品名</th>
            <th class="col-unit-price">単価</th>
            <th class="col-result">結果</th>
          </tr>
        </thead>

       <tbody>
  <% @purchase_quotations.each do |quotation| %>
    <% quotation.purchase_quotation_items.first(20).each_with_index do |item, index| %>
      <tr>
        <td><%= quotation.quotation_date %></td>
        <td><%= quotation.customer.customer_name %></td>
        <td><%= link_to quotation.quotation_number, purchase_quotation_path(quotation) %></td>
        <td><%= item.category&.category_name %></td>
        <td style="text-align: left;"><%= item.item_name %></td>
        <td style="text-align: right;"><%= number_with_delimiter(item.unit_price) %></td>
        <td><%= item.result&.name %></td>
      </tr>
    <% end %>
  <% end %>
</tbody>


      </table>
      <%= paginate @purchase_quotations %>
    </div>
  </div>
</div> 